function loadNewMessagesTicker(){var e=messageIds[0];$.get("/api/messagesSince/"+e,function(e){if(e.length>0){for(var s=e.length-1;s>=0;s--){var a=e[s];-1===$.inArray(a.Id,messageIds)&&(newMessages.unshift(a),messageIds.unshift(a.Id))}newMessages.length>0&&($("#show-new-btn").text("Show "+newMessages.length+" new messages"),$("#show-new-btn").show())}}),setTimeout(loadNewMessagesTicker,interval)}function loadOlderMessages(){var e=$(".message:last-child > input[name=id]").val();$.get("/api/messagesUntil/"+e,function(e){for(var s=1;s<e.length;s++){var a=e[s],n=formatMessage(a);$("#message-stream").append(n)}$("#load-more-btn").show()})}function formatMessage(e){var s=convertToDate(e.Created),a="<div class='message'><input type='hidden' name='id' value='"+e.Id+"'/><input type='hidden' name='created' value='"+s+"'/><img class='user-picture' src='"+e.User.ImageUrl+"' alt='"+e.User.Name+"'/><p class='message-header'><span class='user-name'>"+e.User.Name+"</span><span class='message-timeinfo'>"+s.toString().substring(0,25)+"</span></p><p class='message-text'>"+e.Text+"</p></div>";return a}function convertToDate(e){var s=/\/Date\((\d*)\)\//.exec(e);return new Date(+s[1])}var intervalInSeconds=10,interval=1e3*intervalInSeconds,newMessages=new Array,messageIds=new Array;$(function(){$("#show-new-btn").hide(),$.get("/api/messages",function(e){for(var s=0;s<e.length;s++){var a=e[s],n=formatMessage(a);$("#message-stream").append(n),messageIds.push(a.Id)}setTimeout(loadNewMessagesTicker,interval)}),$("#load-more-btn").click(function(e){e.preventDefault(),$(this).hide(),loadOlderMessages()}),$("#show-new-btn").click(function(e){e.preventDefault();for(var s=newMessages.length-1;s>=0;s--){var a=newMessages[s],n=formatMessage(a);$("#message-stream").prepend(n),newMessages.splice(s,1)}$(this).hide()})});
